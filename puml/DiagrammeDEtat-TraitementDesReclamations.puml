@startuml State Diagram

title Diagramme d'etat - Traitement des Reclamations

[*] --> Initialisation : Demarrage du programme

state Initialisation {
  [*] --> ChargementOptions : Appel a GetSystemOptions()
  ChargementOptions --> ValidationPhase : Verification de la phase
  ValidationPhase --> OuvertureFichiers : Phase valide
  ValidationPhase --> [*] : Phase invalide
  OuvertureFichiers --> InitialisationDonnees : Fichiers ouverts
}

Initialisation --> TraitementCycles : Housekeeping termine

state TraitementCycles {
  [*] --> LectureCycle : Lecture du prochain cycle
  LectureCycle --> AnalyseCycle : Cycle trouve
  LectureCycle --> FinTraitement : Fin de fichier
  
  state AnalyseCycle {
    [*] --> RecuperationReclamation : GetReclaimInfo()
    RecuperationReclamation --> DetectionTOL : DetectTolFailure()
    DetectionTOL --> TraitementReclamation : Traitement specifique
  }
  
  AnalyseCycle --> LectureCycle : Cycle suivant
}

TraitementCycles --> Finalisation : Tous les cycles traites

state Finalisation {
  [*] --> FermetureFichiers : CloseFiles()
  FermetureFichiers --> MiseeJourOptions : UpdateSystemOptions()
  MiseeJourOptions --> TraitementConditionnel : Verification des conditions
  
  state TraitementConditionnel {
    [*] --> [*]
    [*] --> TraitementSecondaire : Si Phase 1 et TOL Participant
    [*] --> TraitementCinquieme : Si Phase 1 et MAX Reclaim
  }
}

Finalisation --> [*] : Fin du programme

@enduml
